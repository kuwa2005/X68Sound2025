# X68Sound2025 環境変数一覧（効果別）

## 📋 目次

1. [基本設定](#基本設定)
2. [音質向上機能](#音質向上機能)
3. [ステレオ強化・立体音響](#ステレオ強化立体音響)
4. [リバーブ・空間系](#リバーブ空間系)
5. [音色補正・エンハンサー](#音色補正エンハンサー)
6. [FM音源エフェクト](#fm音源エフェクト)
7. [ダイナミクス処理](#ダイナミクス処理)
8. [デバッグ・ログ](#デバッグログ)

---

## 基本設定

システムの動作に関する基本的な設定です。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_PCM_BUFFER` | 5 | 2-20 | PCMバッファサイズ。大きいほど安定、小さいほど低遅延 |
| `X68SOUND_BETW_TIME` | 5 | 1-50 | Between時間（ms）。タイマー割り込み間隔 |
| `X68SOUND_LATE_TIME` | 200 | 50-1000 | レイテンシ時間（ms）。大きいほど音途切れに強い |
| `X68SOUND_REV_MARGIN` | 1.0 | 0.1-10.0 | サンプルレート補正係数 |
| `X68SOUND_BUF_MULTIPLIER` | 1 | 1-8 | バッファサイズ乗数。メモリに余裕がある場合に増加 |
| `X68SOUND_OUTPUT_RATE` | 44100 | 15625-192000 | 出力サンプリングレート（Hz） |

**推奨設定:**
- **低遅延重視**: PCM_BUFFER=3, LATE_TIME=100
- **安定性重視**: PCM_BUFFER=8, LATE_TIME=300
- **高音質**: OUTPUT_RATE=96000 または 192000

---

## 音質向上機能

音声信号処理の品質を向上させる機能です。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_LINEAR_INTERPOLATION` | 1 | 0/1 | PCM8/ADPCM線形補間。1=ON推奨 |
| `X68SOUND_VOLUME_SMOOTHING` | 1 | 0/1 | PCM8ボリュームスムージング。1=ON推奨 |
| `X68SOUND_OPM_SINE_INTERP` | 1 | 0/1 | OPM正弦波線形補間。1=ON推奨 |
| `X68SOUND_ADPCM_MODE` | 0 | 0/1 | ADPCMデコーダー。0=Legacy, 1=MSM6258高音質 |
| `X68SOUND_OPM_QUALITY` | 0 | 0-2 | OPM音質モード。0=標準, 1=高品質, 2=最高品質 |

**効果:**
- **線形補間**: エイリアシングノイズを削減、滑らかな音質
- **ボリュームスムージング**: 音量変化のクリックノイズを除去
- **MSM6258モード**: より正確なADPCMデコード、豊かな音色

**推奨設定:**
```batch
set X68SOUND_LINEAR_INTERPOLATION=1
set X68SOUND_VOLUME_SMOOTHING=1
set X68SOUND_OPM_SINE_INTERP=1
set X68SOUND_ADPCM_MODE=1
```

---

## ステレオ強化・立体音響

X68000のL/C/Rパンニングを立体的なステレオ音場に変換する機能です。

### ステレオ幅調整

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_STEREO_WIDTH` | 100 | 50-200 | ステレオ幅（%）。100=通常, 150=広い, 200=超広い |

### クロスフィード（ヘッドホン最適化）

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_CROSSFEED` | 0 | 0-100 | クロスフィードレベル。0=OFF, 30=自然, 50=強い |
| `X68SOUND_CROSSFEED_DELAY` | 2 | 1-10 | クロスフィード遅延（0.1ms単位）。2=0.2ms |

**効果:** ヘッドホンの圧迫感を軽減、自然な定位感

### センターチャンネル幅拡張

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_CENTER_WIDTH` | 0 | 0-100 | センター定位の音を左右に広げる。0=OFF, 70=推奨 |

**効果:** L/C/Rを擬似的に広いステレオ音場に変換

### ハース効果（先行音効果）

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_HAAS_EFFECT` | 0 | 0-100 | ハース効果レベル。0=OFF, 50=推奨 |
| `X68SOUND_HAAS_DELAY` | 5 | 1-10 | ハース効果遅延（0.1ms単位）。5=0.5ms |

**効果:** 音に奥行きと広がりを加え、立体的なサウンドステージを実現

### 初期反射音

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_EARLY_REFLECTIONS` | 0 | 0-100 | 初期反射音レベル。0=OFF, 30=推奨 |

**効果:** 部屋の壁からの反射をシミュレート、空間の深みを演出

**推奨設定（ヘッドホン）:**
```batch
set X68SOUND_STEREO_WIDTH=120
set X68SOUND_CROSSFEED=30
set X68SOUND_CROSSFEED_DELAY=2
set X68SOUND_HAAS_EFFECT=50
set X68SOUND_HAAS_DELAY=5
```

**推奨設定（スピーカー）:**
```batch
set X68SOUND_STEREO_WIDTH=150
set X68SOUND_CENTER_WIDTH=70
set X68SOUND_EARLY_REFLECTIONS=30
```

---

## リバーブ・空間系

部屋の響きや空間感を加える機能です。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_REVERB` | 0 | 0-4 | リバーブタイプ |
| `X68SOUND_REVERB_DECAY` | 70 | 10-95 | リバーブディケイ（残響時間%） |
| `X68SOUND_REVERB_MIX` | 20 | 0-50 | リバーブミックス（Wet/Dry%） |

**リバーブタイプ:**
- **0**: OFF（リバーブなし）
- **1**: Small Room（小さな部屋）
- **2**: Medium Room（中くらいの部屋）- **推奨**
- **3**: Large Room（大きな部屋）
- **4**: Hall（コンサートホール）

**効果:** チップチューンが生演奏のような響きに、音に深みと奥行きを追加

**推奨設定:**
```batch
REM 控えめな空間感
set X68SOUND_REVERB=1
set X68SOUND_REVERB_MIX=15

REM バランスの良い響き
set X68SOUND_REVERB=2
set X68SOUND_REVERB_DECAY=70
set X68SOUND_REVERB_MIX=20

REM ホールのような広い空間
set X68SOUND_REVERB=4
set X68SOUND_REVERB_DECAY=85
set X68SOUND_REVERB_MIX=30
```

---

## 音色補正・エンハンサー

周波数特性を調整し、音色を補正する機能です。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_EXCITER` | 0 | 0-4 | ハーモニックエキサイター（高域補完） |
| `X68SOUND_SUB_BASS` | 0 | 0-4 | サブハーモニックベース（低域補完） |

**エキサイターレベル（高域）:**
- **0**: OFF
- **1**: Gentle（穏やか）
- **2**: Medium（中程度）- **推奨**
- **3**: Strong（強め）
- **4**: Ultra（最強）

**サブベースレベル（低域）:**
- **0**: OFF
- **1**: Subtle（控えめ）
- **2**: Medium（中程度）- **推奨**
- **3**: Strong（強め）
- **4**: Ultra（最強）

**効果:**
- **エキサイター**: 高域に倍音を加え、明瞭度と存在感を向上
- **サブベース**: 低域に下倍音を加え、重厚感とパンチを向上

**推奨設定（バランス型）:**
```batch
set X68SOUND_EXCITER=2
set X68SOUND_SUB_BASS=2
```

**推奨設定（ゲーム向け）:**
```batch
set X68SOUND_EXCITER=3
set X68SOUND_SUB_BASS=3
```

---

## FM音源エフェクト

FM音源（OPM）に特化したエフェクトです。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_FM_HARMONIC` | 0 | 0-4 | FM倍音エンハンサー |
| `X68SOUND_FM_WARMTH` | 0 | 0-4 | FM温かみエフェクト |
| `X68SOUND_FM_CHORUS` | 0 | 0-3 | FMコーラスエフェクト |

**FM倍音エンハンサー:**
- **0**: OFF
- **1**: Subtle（控えめ）
- **2**: Medium（中程度）- **推奨**
- **3**: Rich（豊か）
- **4**: Ultra（超豊か）

**効果:** FM音源の倍音成分を強調、より豊かで立体的な音色

**FM温かみエフェクト:**
- **0**: OFF
- **1**: Subtle（ほんのり）
- **2**: Medium（中程度）- **推奨**
- **3**: Warm（温かい）
- **4**: Ultra（超温かい）

**効果:** デジタル臭さを軽減、アナログシンセのような温かい音色

**FMコーラス:**
- **0**: OFF
- **1**: Subtle（控えめ）
- **2**: Rich（豊か）- **推奨**
- **3**: Deep（深い）

**効果:** FM音源に揺らぎを加え、アナログシンセ風の厚みのある音色

**推奨設定（音楽鑑賞）:**
```batch
set X68SOUND_FM_HARMONIC=2
set X68SOUND_FM_WARMTH=2
```

**推奨設定（ビンテージ風）:**
```batch
set X68SOUND_FM_HARMONIC=3
set X68SOUND_FM_WARMTH=3
set X68SOUND_FM_CHORUS=2
```

---

## ダイナミクス処理

音量レベルを調整する機能です。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_COMPRESSOR` | 0 | 0-3 | マルチバンドコンプレッサー |
| `X68SOUND_LIMITER` | 0 | 0/1 | リミッター。1=ON |

**コンプレッサー:**
- **0**: OFF
- **1**: Gentle（穏やか）
- **2**: Medium（中程度）- **推奨**
- **3**: Hard（強め）

**効果:** 音量差を圧縮、小音も聞き取りやすく、全体的にパンチのある音

**推奨設定:**
```batch
REM ゲーム向け（ダイナミックな音）
set X68SOUND_COMPRESSOR=2
set X68SOUND_LIMITER=1

REM 音楽鑑賞（原音重視）
set X68SOUND_COMPRESSOR=0
set X68SOUND_LIMITER=0
```

---

## デバッグ・ログ

問題発生時の診断に使用します。

| 環境変数 | デフォルト | 範囲 | 説明 |
|---------|-----------|------|------|
| `X68SOUND_DEBUG` | 0 | 0-3 | デバッグログレベル |
| `X68SOUND_DEBUG_LOG_FILE` | (自動) | パス | ログファイル出力先 |

**デバッグレベル:**
- **0**: ログ無効
- **1**: エラーのみ
- **2**: 警告 + エラー
- **3**: すべての情報（詳細）

**ログファイル:** 指定しない場合は自動生成（`X68Sound_YYYYMMDD_HHMMSS.log`）

---

## 📦 プリセット設定例

### 🎵 MUSIC（音楽鑑賞）

```batch
set X68SOUND_OUTPUT_RATE=96000
set X68SOUND_LINEAR_INTERPOLATION=1
set X68SOUND_VOLUME_SMOOTHING=1
set X68SOUND_OPM_SINE_INTERP=1
set X68SOUND_ADPCM_MODE=1
set X68SOUND_EXCITER=2
set X68SOUND_SUB_BASS=2
set X68SOUND_FM_HARMONIC=2
set X68SOUND_FM_WARMTH=2
set X68SOUND_STEREO_WIDTH=150
set X68SOUND_CENTER_WIDTH=70
set X68SOUND_EARLY_REFLECTIONS=30
set X68SOUND_REVERB=2
set X68SOUND_REVERB_DECAY=70
set X68SOUND_REVERB_MIX=20
```

### 🎮 GAMING（ゲーム用）

```batch
set X68SOUND_OUTPUT_RATE=48000
set X68SOUND_LINEAR_INTERPOLATION=1
set X68SOUND_VOLUME_SMOOTHING=1
set X68SOUND_OPM_SINE_INTERP=1
set X68SOUND_ADPCM_MODE=1
set X68SOUND_EXCITER=3
set X68SOUND_SUB_BASS=3
set X68SOUND_FM_HARMONIC=1
set X68SOUND_COMPRESSOR=2
set X68SOUND_LATE_TIME=100
```

### 🎧 HEADPHONE（ヘッドホン用）

```batch
set X68SOUND_OUTPUT_RATE=96000
set X68SOUND_LINEAR_INTERPOLATION=1
set X68SOUND_VOLUME_SMOOTHING=1
set X68SOUND_OPM_SINE_INTERP=1
set X68SOUND_ADPCM_MODE=1
set X68SOUND_EXCITER=2
set X68SOUND_SUB_BASS=1
set X68SOUND_FM_HARMONIC=2
set X68SOUND_FM_WARMTH=2
set X68SOUND_STEREO_WIDTH=120
set X68SOUND_CROSSFEED=30
set X68SOUND_CROSSFEED_DELAY=2
set X68SOUND_HAAS_EFFECT=50
set X68SOUND_HAAS_DELAY=5
set X68SOUND_REVERB=1
set X68SOUND_REVERB_MIX=15
```

### 📻 VINTAGE（アナログ風）

```batch
set X68SOUND_OUTPUT_RATE=48000
set X68SOUND_LINEAR_INTERPOLATION=1
set X68SOUND_VOLUME_SMOOTHING=1
set X68SOUND_OPM_SINE_INTERP=1
set X68SOUND_ADPCM_MODE=1
set X68SOUND_EXCITER=1
set X68SOUND_SUB_BASS=2
set X68SOUND_FM_HARMONIC=3
set X68SOUND_FM_WARMTH=3
set X68SOUND_FM_CHORUS=2
set X68SOUND_EARLY_REFLECTIONS=40
set X68SOUND_REVERB=3
set X68SOUND_REVERB_DECAY=80
set X68SOUND_REVERB_MIX=25
```

---

## 💡 使い方のコツ

### 1. 音質向上機能は常にON
```batch
set X68SOUND_LINEAR_INTERPOLATION=1
set X68SOUND_VOLUME_SMOOTHING=1
set X68SOUND_OPM_SINE_INTERP=1
set X68SOUND_ADPCM_MODE=1
```
これらは副作用なく音質を向上させます。

### 2. エフェクトは控えめから
最初は推奨値（Medium, 2）から始め、好みに応じて調整。

### 3. ステレオ強化は用途に応じて
- **ヘッドホン**: クロスフィード + ハース効果
- **スピーカー**: センターチャンネル幅拡張 + 初期反射音

### 4. リバーブは最後に調整
他のエフェクトを設定した後、リバーブで空間感を微調整。

### 5. 曲によって相性がある
すべての設定がすべての曲に合うわけではありません。
環境変数で簡単にON/OFFできるので、色々試してみてください。

---

## 📚 詳細情報

さらに詳しい説明は `ENVIRONMENT_VARIABLES.md` を参照してください。

## 🐛 トラブルシューティング

- **音が途切れる**: PCM_BUFFERとLATE_TIMEを増やす
- **遅延が大きい**: PCM_BUFFERとLATE_TIMEを減らす
- **エフェクトが効きすぎ**: 各パラメータを1段階下げる
- **音が歪む**: エキサイター、サブベース、コンプレッサーを下げる

---

**作成日**: 2025年
**対応バージョン**: X68Sound2025
